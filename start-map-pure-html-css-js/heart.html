<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Mask Celestial Config (Local JSON)</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            background-color: black;
        }

        .heart-container {
            width: 400px;
            height: 90vh;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ddd;
        }

        svg {
            width: 90%;
            height: auto;
        }

        .heart-outline {
            fill: none;
            stroke: white;
            stroke-width: 1;
        }
    </style>
</head>

<body>
    <div class="heart-container">
        <svg viewBox="170 352 860 798" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <clipPath id="heartClip">
                    <path d="
              M 600 1121
              C 201 869, 33 554, 306 407
              C 474 323, 600 449, 600 554
              C 600 449, 726 323, 894 407
              C 1167 554, 999 869, 600 1121
              Z"></path>
                </clipPath>
            </defs>

            <g id="mwLayer" clip-path="url(#heartClip)"></g>
            <g id="starsLayer" clip-path="url(#heartClip)"></g>
            <g id="dsoLayer" clip-path="url(#heartClip)"></g>
            <g id="constLinesLayer" clip-path="url(#heartClip)"></g>
            <g id="constBoundsLayer" clip-path="url(#heartClip)"></g>
            <g id="moonLayer" clip-path="url(#heartClip)"></g>

            <path class="heart-outline" d="
          M 600 1121
          C 201 869, 33 554, 306 407
          C 474 323, 600 449, 600 554
          C 600 449, 726 323, 894 407
          C 1167 554, 999 869, 600 1121
          Z"></path>
        </svg>
    </div>

    <script>
        // Local JSON paths
        const URLS = {
            stars6: './json/stars.6.json',
            stars8: './json/stars.8.json',
            dsos6: './json/dsos.6.json',
            dsos14: './json/dsos.14.json',
            dsosBright: './json/dsos.bright.json',
            mw: './json/mw.json',
            constLines: './json/constellations.lines.json',
            constBounds: './json/constellations.bounds.json'
        };

        const svg = document.querySelector('svg');
        const viewBox = svg.viewBox.baseVal;
        const WIDTH = viewBox.width;
        const HEIGHT = viewBox.height;

        // ðŸŒŒ Advanced Config Object (All possible options)
        const config = {
            stars: {
                show: true,
                source: 'stars6', // 'stars6', 'stars8', etc.
                density: 1,
                magLimit: 6.5,
                minRadius: 0.5,
                maxRadius: 4,
                color: '#ffffff',
                opacityFactor: 10,
                randomize: true,
                twinkle: true,
                twinkleRange: 0.4
            },
            milkyWay: {
                show: true,
                color: 'rgba(255,255,255,0.05)',
                opacity: 0.05
            },
            dso: {
                show: true,
                sources: ['dsos6', 'dsos14', 'dsosBright'],
                color: 'rgba(255,200,255,0.7)',
                radius: 1.5
            },
            constellations: {
                showLines: true,
                showBounds: true,
                lineColor: 'rgba(0,255,255,0.3)',
                lineWidth: 0.5,
                boundsColor: 'rgba(0,255,0,0.2)'
            },
            moon: {
                show: true,
                color: 'rgba(255,255,200,0.9)',
                radius: 15
            }
        };

        const layers = {
            starsLayer: document.getElementById('starsLayer'),
            mwLayer: document.getElementById('mwLayer'),
            dsoLayer: document.getElementById('dsoLayer'),
            constLinesLayer: document.getElementById('constLinesLayer'),
            constBoundsLayer: document.getElementById('constBoundsLayer'),
            moonLayer: document.getElementById('moonLayer')
        };

        function raDecToXY(ra, dec) {
            const x = (ra / 24) * WIDTH + viewBox.x;
            const y = viewBox.y + HEIGHT - ((dec + 90) / 180) * HEIGHT;
            return { x, y };
        }

        function starRadius(mag) {
            const cfg = config.stars;
            const r = cfg.maxRadius - mag * (cfg.maxRadius - cfg.minRadius) / cfg.magLimit;
            return Math.max(cfg.minRadius, r);
        }

        async function loadStars() {
            if (!config.stars.show) return;
            const response = await fetch(URLS[config.stars.source]);
            const data = await response.json();
            const frag = document.createDocumentFragment();

            data.features.forEach(f => {
                if (Math.random() > config.stars.density) return;
                const mag = f.properties?.mag ?? config.stars.magLimit;
                if (mag > config.stars.magLimit) return;

                const [ra, dec] = f.geometry.coordinates;
                let { x, y } = raDecToXY(ra, dec);
                if (config.stars.randomize) { x += (Math.random() - 0.5) * 2; y += (Math.random() - 0.5) * 2; }

                const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                c.setAttribute('cx', x);
                c.setAttribute('cy', y);
                c.setAttribute('r', starRadius(mag));
                c.setAttribute('fill', config.stars.color);
                c.setAttribute('opacity', (0.95 - mag / config.stars.opacityFactor));
                frag.appendChild(c);
            });

            layers.starsLayer.appendChild(frag);
            if (config.stars.twinkle) animateTwinkle();
        }

        function animateTwinkle() {
            const stars = layers.starsLayer.querySelectorAll('circle');
            function tick() {
                stars.forEach(s => {
                    const baseOpacity = parseFloat(s.getAttribute('opacity'));
                    const delta = (Math.random() - 0.5) * config.stars.twinkleRange;
                    s.setAttribute('opacity', Math.max(0, Math.min(1, baseOpacity + delta)));
                });
                requestAnimationFrame(tick);
            }
            requestAnimationFrame(tick);
        }

        async function loadMilkyWay() {
            if (!config.milkyWay.show) return;
            const resp = await fetch(URLS.mw);
            const data = await resp.json();
            const frag = document.createDocumentFragment();
            data.features.forEach(f => {
                const [ra, dec] = f.geometry.coordinates;
                const { x, y } = raDecToXY(ra, dec);
                const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                c.setAttribute('cx', x);
                c.setAttribute('cy', y);
                c.setAttribute('r', 1);
                c.setAttribute('fill', config.milkyWay.color);
                c.setAttribute('opacity', config.milkyWay.opacity);
                frag.appendChild(c);
            });
            layers.mwLayer.appendChild(frag);
        }

        async function loadDSO() {
            if (!config.dso.show) return;
            for (const src of config.dso.sources) {
                const resp = await fetch(URLS[src]);
                const data = await resp.json();
                const frag = document.createDocumentFragment();
                data.features.forEach(f => {
                    const [ra, dec] = f.geometry.coordinates;
                    const { x, y } = raDecToXY(ra, dec);
                    const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    c.setAttribute('cx', x);
                    c.setAttribute('cy', y);
                    c.setAttribute('r', config.dso.radius);
                    c.setAttribute('fill', config.dso.color);
                    frag.appendChild(c);
                });
                layers.dsoLayer.appendChild(frag);
            }
        }

        async function loadConstellations() {
            if (config.constellations.showLines) {
                const resp = await fetch(URLS.constLines);
                const data = await resp.json();
                const frag = document.createDocumentFragment();
                data.features.forEach(f => {
                    f.geometry.coordinates.forEach(lineSeg => {
                        for (let i = 0; i < lineSeg.length - 1; i++) {
                            const { x: x1, y: y1 } = raDecToXY(...lineSeg[i]);
                            const { x: x2, y: y2 } = raDecToXY(...lineSeg[i + 1]);
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', x1);
                            line.setAttribute('y1', y1);
                            line.setAttribute('x2', x2);
                            line.setAttribute('y2', y2);
                            line.setAttribute('stroke', config.constellations.lineColor);
                            line.setAttribute('stroke-width', config.constellations.lineWidth);
                            frag.appendChild(line);
                        }
                    });
                });
                layers.constLinesLayer.appendChild(frag);
            }

            if (config.constellations.showBounds) {
                const resp = await fetch(URLS.constBounds);
                const data = await resp.json();
                const frag = document.createDocumentFragment();
                data.features.forEach(f => {
                    const coords = f.geometry.coordinates[0];
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    const points = coords.map(c => {
                        const { x, y } = raDecToXY(...c);
                        return `${x},${y}`;
                    }).join(' ');
                    path.setAttribute('points', points);
                    path.setAttribute('fill', config.constellations.boundsColor);
                    frag.appendChild(path);
                });
                layers.constBoundsLayer.appendChild(frag);
            }
        }

        function loadMoon() {
            if (!config.moon.show) return;
            const cx = WIDTH / 2 + viewBox.x;
            const cy = HEIGHT / 2 + viewBox.y;
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', cx);
            circle.setAttribute('cy', cy);
            circle.setAttribute('r', config.moon.radius);
            circle.setAttribute('fill', config.moon.color);
            layers.moonLayer.appendChild(circle);
        }

        // Load everything
        loadMilkyWay();
        loadStars();
        loadDSO();
        loadConstellations();
        loadMoon();
    </script>
</body>

</html>